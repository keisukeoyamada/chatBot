<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/styles.css">
    <title>GeminiAI Chatbot</title>
</head>

<body>
    <h1>Chatbot <span id="smallfont">powered by GeminiAI</span> </h1>
    <div>keisuke.Oが練習用に作成したアプリケーションです</div>
    <label for="model-select">モデルを選択：</label>
    <select id="model-select">
        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
        <option value="gemini-1.0-pro">Gemini 1.0 Pro</option>
    </select>

    <!-- 温度設定 -->
    <label for="temperature-slider">temperature（創造性）:</label>
    <input type="range" id="temperature-slider" min="0.0" max="1.0" step="0.1" value="0.5">
    <span id="temperature-value">0.5</span>

    <div class="container">
        <textarea id="user-input" placeholder="
        こんにちは！私はGeminiのチャットボットです。
        喜んでお手伝いします。
        どんなご用件でしょうか？" oninput="adjustHeight(this)"></textarea>
        <button type="text" id="send-button" onclick="sendMessage()">送信</button>
    </div>
    <div id="loading-icon"></div>
    <div id="response">
        <h2>会話ログ</h2>
        {% for conversation in conversations | reverse %}
        <div><strong>過去の質問:</strong> {{ conversation.user_input }}</div>
        <div><strong>Geminiの返答:</strong> {{ conversation.bot_response }}</div>
        <hr>
        {% endfor %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // 温度スライダーの値をリアルタイム表示
        document.getElementById('temperature-slider').addEventListener('input', function () {
            document.getElementById('temperature-value').innerText = this.value;
        });

        function sendMessage() {
            const input = document.getElementById('user-input').value;
            const model = document.getElementById('model-select').value;
            const temperature = parseFloat(document.getElementById('temperature-slider').value);
            const loadingIcon = document.getElementById('loading-icon'); // ここで変数を定義
            // console.log(loadingIcon);　コンソールで確認
            loadingIcon.style.display = 'block'; // アイコンを表示

            fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ input: input, model: model, temperature: temperature })
            })
                .then(response => response.json())

                .then(data => {
                    // document.getElementById('response').innerText = data.response;
                    document.getElementById('response').innerHTML = marked.parse(data.response);
                    console.log("Bot Response:", data.response);
                    console.log("Model:", data.model);
                    console.log("Temperature:", data.temperature);
                })
                .catch(error => console.error('Error:', error))
                .finally(() => {
                    loadingIcon.style.display = 'none';
                });
        }
        function adjustHeight(element) {
            element.style.height = 'auto';  // 一旦高さをリセット
            element.style.height = (element.scrollHeight) + 'px';  // 内容に応じて高さを設定
        }
    </script>
    <footer>
        <p>&copy; 2024 Kei.O. All rights reserved.</p>
    </footer>
</body>

</html>
